{% extends  'main/base.html'%}
{% block title %}Home Page{% endblock %}
{% block content %}
{% for post in posts %}
<div class="card mt-2 {% if post.author.is_superuser %}border-danger{% endif %}">
    <div class="card-header">
        @<strong>{{ post.author.username }}</strong>
        {% if post.author.is_superuser %}
            <span class="badge bg-danger ms-2">Owner</span>
        {% endif %}
    </div>
    <div class="card-body d-flex flex-row justify-content-between">
        <div>
            <h5 class="card-title">{{ post.title }}</h5>
            <p>{{ post.description }}</p> 
        </div>
        <div>
            {% if user == post.author or user.is_superuser %}
            <form method="post" action="{% url 'delete_post' post.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
            {% endif %}
        </div>
    </div>
    <div class="card-footer text-muted">{{ post.created_at }}</div>

    {# Show comment form and comments only for superuser posts #}
    {% if post.author.is_superuser %}
        <div class="mt-3 ms-3">
            <h6>Comments:</h6>
            {% for comment in post.comments.all %}
                <div class="border rounded p-2 mb-2 d-flex justify-content-between align-items-center">
                    <div>
                        <strong>{{ comment.author.username }}</strong>: {{ comment.content }}
                        <span class="text-muted" style="font-size:small;">{{ comment.created_at }}</span>
                    </div>
                    {% if user.is_superuser or user == comment.author %}
                        <form method="post" action="{% url 'delete_comment' comment.id %}?next={{ request.path }}" style="margin:0;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-outline-danger btn-sm ms-2" title="Delete Comment">&times;</button>
                        </form>
                    {% endif %}
                </div>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}
            {% if not user.is_superuser %}
                <form method="post" class="mt-2">
                    {% csrf_token %}
                    <textarea name="content" class="form-control mb-2" rows="2" required placeholder="Write your comment..."></textarea>
                    <input type="hidden" name="comment-post-id" value="{{ post.id }}">
                    <button type="submit" class="btn btn-primary btn-sm">Reply</button>
                </form>
            {% endif %}
        </div>
    {% endif %}
</div>
{% empty %}
<p>No posts yet :(</p>
{% endfor %}
{% endblock %}
